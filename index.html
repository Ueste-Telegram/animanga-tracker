<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AniManga Tracker</title>
    
    <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="Track your anime and manga progress">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192x192.png">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* üîß –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò –ò –°–ë–†–û–° */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
            --light-bg: #ffffff;
            --light-card: #f8f9fa;
            --light-text: #2d3748;
            --light-border: #e2e8f0;
            --light-accent: #667eea;
            --light-secondary: #764ba2;
            --light-hover: #edf2f7;
            --light-shadow: rgba(0, 0, 0, 0.1);
            
            /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
            --dark-bg: #0f0f23;
            --dark-card: #1a1a2e;
            --dark-text: #ffffff;
            --dark-border: #2d3748;
            --dark-accent: #667eea;
            --dark-secondary: #764ba2;
            --dark-hover: #2d3748;
            --dark-shadow: rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 15px;
            transition: all 0.3s ease;
            line-height: 1.5;
        }

        body.light-theme {
            --bg-color: var(--light-bg);
            --card-color: var(--light-card);
            --text-color: var(--light-text);
            --border-color: var(--light-border);
            --accent-color: var(--light-accent);
            --secondary-color: var(--light-secondary);
            --hover-color: var(--light-hover);
            --shadow-color: var(--light-shadow);
        }

        body.dark-theme {
            --bg-color: var(--dark-bg);
            --card-color: var(--dark-card);
            --text-color: var(--dark-text);
            --border-color: var(--dark-border);
            --accent-color: var(--dark-accent);
            --secondary-color: var(--dark-secondary);
            --hover-color: var(--dark-hover);
            --shadow-color: var(--dark-shadow);
        }

        /* üîß –ö–û–ù–¢–ï–ô–ù–ï–† –ò –û–°–ù–û–í–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê */
        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--card-color);
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--text-color);
            opacity: 0.8;
            font-size: 14px;
        }

        /* üîß –°–ò–°–¢–ï–ú–ê –í–ö–õ–ê–î–û–ö */
        .tabs {
            display: flex;
            background: var(--card-color);
            border-radius: 12px;
            padding: 6px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px var(--shadow-color);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            flex: 1;
            min-width: 70px;
            padding: 12px 8px;
            text-align: center;
            color: var(--text-color);
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            opacity: 0.7;
            white-space: nowrap;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            color: white;
            opacity: 1;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* üîß –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ */
        .content {
            background: var(--card-color);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px var(--shadow-color);
            margin-bottom: 20px;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* üîß –§–û–†–ú–´ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-color);
            font-weight: 600;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background: var(--card-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control::placeholder {
            color: var(--text-color);
            opacity: 0.5;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-color);
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: var(--hover-color);
            transform: translateY(-2px);
        }

        /* üîß –ö–ê–†–¢–û–ß–ö–ò –≠–õ–ï–ú–ï–ù–¢–û–í */
        .item-card {
            background: var(--card-color);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .item-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 12px;
        }

        .item-cover {
            width: 80px;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid var(--border-color);
            flex-shrink: 0;
        }

        .no-cover {
            width: 80px;
            height: 120px;
            border-radius: 8px;
            background: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            opacity: 0.5;
            font-size: 12px;
            text-align: center;
            flex-shrink: 0;
            border: 2px dashed var(--border-color);
        }

        .item-info {
            flex: 1;
            min-width: 0;
        }

        .item-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--text-color);
            word-break: break-word;
        }

        .item-meta {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .rating {
            display: flex;
            gap: 2px;
            margin: 10px 0;
        }

        .star {
            font-size: 18px;
            cursor: pointer;
            color: #ddd;
            transition: all 0.2s ease;
        }

        .star.active {
            color: #FFD700;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.3);
        }

        .star:hover {
            transform: scale(1.2);
        }

        .progress-bar {
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .item-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            text-align: center;
        }

        .btn-edit {
            background: var(--accent-color);
            color: white;
        }

        .btn-delete {
            background: #ff4757;
            color: white;
        }

        .btn-progress {
            background: var(--secondary-color);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* üîß –°–ò–°–¢–ï–ú–ê –°–¢–ê–¢–£–°–û–í */
        .status-tabs {
            display: flex;
            background: var(--card-color);
            border-radius: 10px;
            padding: 4px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px var(--shadow-color);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .status-tabs::-webkit-scrollbar {
            display: none;
        }

        .status-tab {
            flex: 1;
            min-width: 60px;
            padding: 10px 8px;
            text-align: center;
            color: var(--text-color);
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 500;
            opacity: 0.7;
            white-space: nowrap;
        }

        .status-tab.active {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            color: white;
            opacity: 1;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .status-content {
            display: none;
        }

        .status-content.active {
            display: block;
        }

        /* üîß –ü–û–ò–°–ö –ò –§–ò–õ–¨–¢–†–´ */
        .search-box {
            margin-bottom: 15px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 14px 45px 14px 14px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--card-color);
            color: var(--text-color);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            opacity: 0.5;
        }

        /* üîß –ü–£–°–¢–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: var(--text-color);
            opacity: 0.6;
        }

        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state h4 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .empty-state p {
            font-size: 14px;
            line-height: 1.4;
        }

        /* üîß –ù–ê–°–¢–†–û–ô–ö–ò */
        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-option:last-child {
            border-bottom: none;
        }

        .settings-label {
            font-weight: 600;
            color: var(--text-color);
            font-size: 16px;
            margin-bottom: 4px;
        }

        .settings-description {
            color: var(--text-color);
            opacity: 0.7;
            font-size: 14px;
            line-height: 1.4;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .theme-selector, .language-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .theme-btn, .lang-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            background: var(--card-color);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            text-align: center;
        }

        .theme-btn.active, .lang-btn.active {
            border-color: var(--accent-color);
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* üîß –ü–†–ï–î–ü–†–û–°–ú–û–¢–† –û–ë–õ–û–ñ–ï–ö */
        .cover-preview {
            width: 100%;
            max-width: 200px;
            border-radius: 8px;
            margin-top: 10px;
            border: 2px solid var(--border-color);
            display: none;
        }

        /* üîß –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--card-color);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        /* üîß –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent-color), var(--secondary-color));
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            max-width: 320px;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid #FFD700;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.success {
            border-left-color: #4CAF50;
        }

        .notification.error {
            border-left-color: #ff4757;
        }

        .notification.warning {
            border-left-color: #ffa502;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .notification-message {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* üîß PWA –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .pwa-install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: var(--card-color);
            border: 2px solid var(--accent-color);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 20px var(--shadow-color);
            z-index: 10001;
            display: none;
        }

        .pwa-install-prompt.show {
            display: block;
            animation: slideInUp 0.3s ease;
        }

        @keyframes slideInUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .pwa-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .pwa-buttons .btn {
            margin: 0;
            flex: 1;
        }

        /* üîß –ê–ù–ò–ú–ê–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò */
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-color);
            opacity: 0.6;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* üîß –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–Ø UX */
        .progress-section {
            margin: 15px 0;
        }

        .progress-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 12px 0;
        }

        .progress-btn {
            background: var(--border-color);
            border: none;
            color: var(--text-color);
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 16px;
            font-weight: bold;
        }

        .progress-btn:hover {
            background: var(--accent-color);
            color: white;
            transform: scale(1.1);
        }

        .progress-input {
            background: var(--card-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            padding: 8px 12px;
            text-align: center;
            width: 70px;
            font-size: 16px;
            font-weight: 600;
        }

        .progress-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .progress-text {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
            margin-left: 8px;
        }

        .completion-badge {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        .quick-progress {
            display: flex;
            gap: 6px;
            margin-top: 10px;
        }

        .quick-progress-btn {
            background: var(--border-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            padding: 6px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
        }

        .quick-progress-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        /* üîß –°–¢–ò–õ–ò –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø */
        .edit-form {
            background: var(--card-color);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border: 2px solid var(--accent-color);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .edit-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-save {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-cancel {
            background: var(--border-color);
            color: var(--text-color);
        }

        /* üîß –°–¢–ò–õ–ò –î–õ–Ø ANILIST –ü–û–ò–°–ö–ê */
        .anilist-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            padding: 20px;
        }

        .anilist-modal-content {
            background: var(--card-color);
            border-radius: 16px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid var(--accent-color);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .anilist-search-box {
            position: relative;
            margin-bottom: 15px;
        }

        .anilist-search-input {
            width: 100%;
            padding: 14px 45px 14px 14px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--card-color);
            color: var(--text-color);
            font-size: 16px;
        }

        .anilist-search-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .anilist-results {
            margin-top: 15px;
        }

        .anilist-result-item {
            background: var(--card-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .anilist-result-item:hover {
            transform: translateY(-2px);
            border-color: var(--accent-color);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .anilist-cover {
            width: 60px;
            height: 90px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .anilist-info {
            flex: 1;
        }

        .anilist-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .anilist-meta {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.7;
        }

        .anilist-loading {
            text-align: center;
            padding: 20px;
            color: var(--text-color);
            opacity: 0.6;
        }

        .anilist-error {
            text-align: center;
            padding: 20px;
            color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
            border-radius: 12px;
            margin: 10px 0;
        }

        /* üîß –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            .tab {
                padding: 10px 6px;
                font-size: 12px;
            }
            
            .content {
                padding: 15px;
            }
            
            .form-control {
                padding: 12px;
                font-size: 16px;
            }
            
            .btn {
                padding: 14px 20px;
                font-size: 16px;
            }
            
            .item-header {
                gap: 12px;
            }
            
            .item-cover, .no-cover {
                width: 70px;
                height: 105px;
            }
            
            .action-btn {
                padding: 8px 10px;
                font-size: 13px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 24px;
            }
        }

        /* üîß SCROLLBAR */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* üîß TELEGRAM WEB APP SPECIFIC */
        .tg-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            z-index: -1;
        }
    </style>
</head>
<body class="dark-theme">
    <div class="tg-background"></div>
    
    <!-- PWA Install Prompt -->
    <div class="pwa-install-prompt" id="pwaInstallPrompt">
        <h4>üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h4>
        <p>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ AniManga Tracker –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ Telegram</p>
        <div class="pwa-buttons">
            <button class="btn" onclick="installPWA()">‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
            <button class="btn btn-secondary" onclick="dismissPWA()">‚ùå –ü–æ–∑–∂–µ</button>
        </div>
    </div>
    
    <div class="container">
        <!-- üîî –ü–∞–Ω–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
        <div id="notificationsPanel"></div>
        
        <div class="header">
            <h1>üéå AniManga Tracker</h1>
            <p id="welcomeText">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –∞–Ω–∏–º–µ –∏ –º–∞–Ω–≥—É</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showSection('anime')" id="tabAnime">üé¨ –ê–Ω–∏–º–µ</button>
            <button class="tab" onclick="showSection('manga')" id="tabManga">üìö –ú–∞–Ω–≥–∞</button>
            <button class="tab" onclick="showSection('stats')" id="tabStats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab" onclick="showSection('settings')" id="tabSettings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>
        
        <div class="content">
            <!-- üé¨ –°–ï–ö–¶–ò–Ø –ê–ù–ò–ú–ï -->
            <div id="anime" class="section active">
                <div class="form-group">
                    <label for="animeTitle" id="labelAnimeTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∏–º–µ</label>
                    <input type="text" id="animeTitle" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞—Ä—É—Ç–æ">
                </div>
                
                <div class="form-group">
                    <label for="animeCover" id="labelAnimeCover">–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–æ–∂–∫—É</label>
                    <input type="text" id="animeCover" class="form-control" placeholder="https://example.com/cover.jpg" onchange="previewCover('anime')">
                    <img id="animeCoverPreview" class="cover-preview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–ª–æ–∂–∫–∏">
                </div>
                
                <div class="form-group">
                    <label for="animeStatus" id="labelAnimeStatus">–°—Ç–∞—Ç—É—Å</label>
                    <select id="animeStatus" class="form-control" onchange="handleStatusChange('anime')">
                        <option value="watching">üëÄ –°–º–æ—Ç—Ä—é</option>
                        <option value="planned">üìÖ –í –ø–ª–∞–Ω–∞—Ö</option>
                        <option value="completed">‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ</option>
                        <option value="dropped">‚ùå –ë—Ä–æ—à–µ–Ω–æ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="animeEpisodes" id="labelAnimeEpisodes">–í—Å–µ–≥–æ —ç–ø–∏–∑–æ–¥–æ–≤</label>
                    <input type="number" id="animeEpisodes" class="form-control" value="12" min="1">
                </div>
                
                <div class="form-group">
                    <label for="animeProgress" id="labelAnimeProgress">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ —ç–ø–∏–∑–æ–¥–æ–≤</label>
                    <input type="number" id="animeProgress" class="form-control" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label id="labelAnimeRating">–†–µ–π—Ç–∏–Ω–≥</label>
                    <div class="rating" id="animeRating">
                        <span class="star" data-value="1">‚òÖ</span>
                        <span class="star" data-value="2">‚òÖ</span>
                        <span class="star" data-value="3">‚òÖ</span>
                        <span class="star" data-value="4">‚òÖ</span>
                        <span class="star" data-value="5">‚òÖ</span>
                    </div>
                    <div style="color: var(--text-color); opacity: 0.7; font-size: 12px; margin-top: 5px;" id="animeRatingHelp">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–≤–µ–∑–¥—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏</div>
                </div>

                <!-- üîç –ö–ù–û–ü–ö–ê –ü–û–ò–°–ö–ê –í ANILIST -->
                <div class="form-group">
                    <button type="button" class="btn btn-secondary" onclick="showAniListSearch('anime')" 
                            style="margin-bottom: 10px; background: #6e56cf; border: none;">
                        üîç –ü–æ–∏—Å–∫ –≤ AniList
                    </button>
                </div>
                
                <button class="btn" onclick="addAnime()" id="btnAddAnime">üé¨ –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–µ</button>
                
                <!-- –í–∫–ª–∞–¥–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –∞–Ω–∏–º–µ -->
                <div class="status-tabs" id="animeStatusTabs">
                    <button class="status-tab active" data-status="all" id="animeTabAll">üì∫ –í—Å–µ (0)</button>
                    <button class="status-tab" data-status="watching" id="animeTabWatching">üëÄ –°–º–æ—Ç—Ä—é (0)</button>
                    <button class="status-tab" data-status="planned" id="animeTabPlanned">üìÖ –ü–ª–∞–Ω—ã (0)</button>
                    <button class="status-tab" data-status="completed" id="animeTabCompleted">‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ (0)</button>
                    <button class="status-tab" data-status="dropped" id="animeTabDropped">‚ùå –ë—Ä–æ—à–µ–Ω–æ (0)</button>
                </div>
                
                <div class="search-box">
                    <input type="text" id="animeSearch" class="form-control" placeholder="üîç –ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ..." onkeyup="searchItems('anime')">
                    <div class="search-icon">üîç</div>
                </div>
                
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∞–Ω–∏–º–µ -->
                <div id="animeAllContent" class="status-content active">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div id="loadingAnimeText">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∏–º–µ...</div>
                    </div>
                </div>
                <div id="animeWatchingContent" class="status-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                <div id="animePlannedContent" class="status-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                <div id="animeCompletedContent" class="status-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                <div id="animeDroppedContent" class="status-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>
            
            <!-- üìö –°–ï–ö–¶–ò–Ø –ú–ê–ù–ì–ò -->
            <div id="manga" class="section">
                <div class="form-group">
                    <label for="mangaTitle" id="labelMangaTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–Ω–≥–∏</label>
                    <input type="text" id="mangaTitle" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–∞–Ω –ü–∏—Å">
                </div>
                
                <div class="form-group">
                    <label for="mangaCover" id="labelMangaCover">–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–æ–∂–∫—É</label>
                    <input type="text" id="mangaCover" class="form-control" placeholder="https://example.com/cover.jpg" onchange="previewCover('manga')">
                    <img id="mangaCoverPreview" class="cover-preview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–ª–æ–∂–∫–∏">
                </div>
                
                <div class="form-group">
                    <label for="mangaStatus" id="labelMangaStatus">–°—Ç–∞—Ç—É—Å</label>
                    <select id="mangaStatus" class="form-control" onchange="handleStatusChange('manga')">
                        <option value="reading">üëÄ –ß–∏—Ç–∞—é</option>
                        <option value="planned">üìÖ –í –ø–ª–∞–Ω–∞—Ö</option>
                        <option value="completed">‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                        <option value="dropped">‚ùå –ë—Ä–æ—à–µ–Ω–æ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="mangaChapters" id="labelMangaChapters">–í—Å–µ–≥–æ –≥–ª–∞–≤</label>
                    <input type="number" id="mangaChapters" class="form-control" value="50" min="1">
                </div>
                
                <div class="form-group">
                    <label for="mangaProgress" id="labelMangaProgress">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ –≥–ª–∞–≤</label>
                    <input type="number" id="mangaProgress" class="form-control" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label id="labelMangaRating">–†–µ–π—Ç–∏–Ω–≥</label>
                    <div class="rating" id="mangaRating">
                        <span class="star" data-value="1">‚òÖ</span>
                        <span class="star" data-value="2">‚òÖ</span>
                        <span class="star" data-value="3">‚òÖ</span>
                        <span class="star" data-value="4">‚òÖ</span>
                        <span class="star" data-value="5">‚òÖ</span>
                    </div>
                    <div style="color: var(--text-color); opacity: 0.7; font-size: 12px; margin-top: 5px;" id="mangaRatingHelp">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–≤–µ–∑–¥—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏</div>
                </div>

                <!-- üîç –ö–ù–û–ü–ö–ê –ü–û–ò–°–ö–ê –í ANILIST -->
                <div class="form-group">
                    <button type="button" class="btn btn-secondary" onclick="showAniListSearch('manga')" 
                            style="margin-bottom: 10px; background: #6e56cf; border: none;">
                        üîç –ü–æ–∏—Å–∫ –≤ AniList
                    </button>
                </div>
                
                <button class="btn" onclick="addManga()" id="btnAddManga">üìö –î–æ–±–∞–≤–∏—Ç—å –º–∞–Ω–≥—É</button>
                
                <!-- –í–∫–ª–∞–¥–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –º–∞–Ω–≥–∏ -->
                <div class="status-tabs" id="mangaStatusTabs">
                    <button class="status-tab active" data-status="all" id="mangaTabAll">üìö –í—Å–µ (0)</button>
                    <button class="status-tab" data-status="reading" id="mangaTabReading">üëÄ –ß–∏—Ç–∞—é (0)</button>
                    <button class="status-tab" data-status="planned" id="mangaTabPlanned">üìÖ –ü–ª–∞–Ω—ã (0)</button>
                    <button class="status-tab" data-status="completed" id="mangaTabCompleted">‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–æ (0)</button>
                    <button class="status-tab" data-status="dropped" id="mangaTabDropped">‚ùå –ë—Ä–æ—à–µ–Ω–æ (0)</button>
                </div>
                
                <div class="search-box">
                    <input type="text" id="mangaSearch" class="form-control" placeholder="üîç –ü–æ–∏—Å–∫ –º–∞–Ω–≥–∏..." onkeyup="searchItems('manga')">
                    <div class="search-icon">üîç</div>
                </div>
                
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –º–∞–Ω–≥–∏ -->
                <div id="mangaAllContent" class="status-content active">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div id="loadingMangaText">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–Ω–≥–∏...</div>
                    </div>
                </div>
                <div id="mangaReadingContent" class="status-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                <div id="mangaPlannedContent" class="status-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                <div id="mangaCompletedContent" class="status-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
                <div id="mangaDroppedContent" class="status-content">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    </div>
                </div>
            </div>
            
            <!-- üìä –°–ï–ö–¶–ò–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò -->
            <div id="stats" class="section">
                <h3 style="text-align: center; margin-bottom: 20px; color: var(--accent-color);" id="statsTitle">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalAnime">0</div>
                        <div class="stat-label" id="statTotalAnime">–í—Å–µ–≥–æ –∞–Ω–∏–º–µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalManga">0</div>
                        <div class="stat-label" id="statTotalManga">–í—Å–µ–≥–æ –º–∞–Ω–≥–∏</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedAnime">0</div>
                        <div class="stat-label" id="statCompletedAnime">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedManga">0</div>
                        <div class="stat-label" id="statCompletedManga">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
                    </div>
                </div>
                
                <div style="margin-top: 25px;">
                    <h4 style="color: var(--accent-color); margin-bottom: 15px; text-align: center;" id="statsChartsTitle">–ì—Ä–∞—Ñ–∏–∫–∏</h4>
                    <canvas id="statsChart" width="400" height="200" style="max-width: 100%;"></canvas>
                </div>
            </div>
            
            <!-- ‚öôÔ∏è –°–ï–ö–¶–ò–Ø –ù–ê–°–¢–†–û–ï–ö -->
            <div id="settings" class="section">
                <h3 style="text-align: center; margin-bottom: 20px; color: var(--accent-color);" id="settingsTitle">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                
                <div class="settings-option">
                    <div>
                        <div class="settings-label" id="settingsThemeLabel">–¢–µ–º–∞</div>
                        <div class="settings-description" id="settingsThemeDesc">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–µ—Ç–ª—É—é –∏–ª–∏ —Ç–µ–º–Ω—É—é —Ç–µ–º—É</div>
                    </div>
                </div>
                <div class="theme-selector">
                    <button class="theme-btn active" onclick="setTheme('dark')" id="themeDark">üåô –¢–µ–º–Ω–∞—è</button>
                    <button class="theme-btn" onclick="setTheme('light')" id="themeLight">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</button>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div class="settings-label" id="settingsLanguageLabel">–Ø–∑—ã–∫</div>
                        <div class="settings-description" id="settingsLanguageDesc">–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</div>
                    </div>
                </div>
                <div class="language-selector">
                    <button class="lang-btn active" onclick="setLanguage('ru')" id="langRu">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
                    <button class="lang-btn" onclick="setLanguage('en')" id="langEn">üá∫üá∏ English</button>
                </div>
                
                <!-- PWA Section -->
                <div class="settings-option">
                    <div>
                        <div class="settings-label" id="settingsPwaLabel">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
                        <div class="settings-description" id="settingsPwaDesc">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ Telegram</div>
                    </div>
                    <button class="btn-secondary" style="padding: 10px 15px; width: auto;" onclick="showPWAInstallPrompt()" id="btnPwaInstall">üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div class="settings-label" id="settingsExportLabel">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                        <div class="settings-description" id="settingsExportDesc">–°–∫–∞—á–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö</div>
                    </div>
                    <button class="btn-secondary" style="padding: 10px 15px; width: auto;" onclick="exportData()" id="btnExport">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
                </div>
                
                <div class="settings-option">
                    <div>
                        <div class="settings-label" id="settingsImportLabel">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                        <div class="settings-description" id="settingsImportDesc">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞</div>
                    </div>
                    <button class="btn-secondary" style="padding: 10px 15px; width: auto;" onclick="importData()" id="btnImport">üì§ –ò–º–ø–æ—Ä—Ç</button>
                </div>
                
                <button class="btn" onclick="clearAllData()" style="margin-top: 25px; background: #ff4757;" id="btnClearData">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            </div>
        </div>
    </div>

    <script>
        // üîß –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´
        const STORAGE_KEY = 'animanga_tracker_data';
        const APP_VERSION = '4.2.0'; // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ –∫—ç—à–∞
        
        // üîÑ –ê–ì–†–ï–°–°–ò–í–ù–û–ï –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–≠–®–ê
        (function() {
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º –∫—ç—à
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    names.forEach(function(name) {
                        caches.delete(name);
                    });
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –≤–µ—Ä—Å–∏–∏ –∫ URL
            const currentUrl = window.location.href;
            const versionParam = 'v=' + APP_VERSION + '-' + Date.now();
            if (!currentUrl.includes('v=')) {
                const newUrl = currentUrl + (currentUrl.includes('?') ? '&' : '?') + versionParam;
                window.history.replaceState(null, null, newUrl);
            }
            
            // –û—á–∏—â–∞–µ–º –∫—ç—à localStorage –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏
            const storedVersion = localStorage.getItem('app_version');
            if (storedVersion !== APP_VERSION) {
                localStorage.clear();
                localStorage.setItem('app_version', APP_VERSION);
                console.log('Cache cleared, app updated to version:', APP_VERSION);
            }
        })();

        let tg = null;
        let currentAnimeRating = 0;
        let currentMangaRating = 0;
        let currentLanguage = 'ru';
        let currentTheme = 'dark';
        let currentAnimeStatusTab = 'all';
        let currentMangaStatusTab = 'all';
        let charts = {};
        let activeSearchTerms = {
            anime: '',
            manga: ''
        };
        let deferredPrompt = null;
        let isPWAInstalled = false;
        let isTelegramWebApp = false;

        // üîß ANILIST API –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
        let currentSearchType = 'anime';

        function showAniListSearch(type) {
            currentSearchType = type;
            
            const modalHTML = `
                <div class="anilist-modal" id="anilistModal">
                    <div class="anilist-modal-content">
                        <h3 style="color: var(--accent-color); margin-bottom: 15px; text-align: center;">
                            üîç ${type === 'anime' ? '–ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ' : '–ü–æ–∏—Å–∫ –º–∞–Ω–≥–∏'} –≤ AniList
                        </h3>
                        
                        <div class="anilist-search-box">
                            <input type="text" id="anilistSearchInput" class="anilist-search-input" 
                                   placeholder="${type === 'anime' ? '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∏–º–µ...' : '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–Ω–≥–∏...'}" 
                                   onkeypress="handleAniListSearch(event)">
                            <div class="search-icon">üîç</div>
                        </div>
                        
                        <div id="anilistResults" class="anilist-results">
                            <div class="anilist-loading">
                                <div>üîç –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ AniList</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button class="btn" onclick="searchAniList()" style="flex: 1;">üîç –ò—Å–∫–∞—Ç—å</button>
                            <button class="btn btn-secondary" onclick="closeAniListModal()" style="flex: 1;">
                                ‚ùå –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            setTimeout(() => {
                const input = document.getElementById('anilistSearchInput');
                if (input) input.focus();
            }, 300);
        }

        function closeAniListModal() {
            const modal = document.getElementById('anilistModal');
            if (modal) {
                modal.remove();
            }
        }

        function handleAniListSearch(event) {
            if (event.key === 'Enter') {
                searchAniList();
            }
        }

        async function searchAniList() {
            const query = document.getElementById('anilistSearchInput').value.trim();
            const resultsContainer = document.getElementById('anilistResults');
            
            if (!query) {
                resultsContainer.innerHTML = '<div class="anilist-error">–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞</div>';
                return;
            }
            
            resultsContainer.innerHTML = `
                <div class="anilist-loading">
                    <div class="loading-spinner"></div>
                    <div>–ò—â–µ–º –≤ –±–∞–∑–µ AniList...</div>
                </div>
            `;
            
            try {
                const response = await fetch('https://graphql.anilist.co', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    body: JSON.stringify({
                        query: `
                            query ($search: String, $type: MediaType) {
                                Page (perPage: 10) {
                                    media (search: $search, type: $type) {
                                        id
                                        title {
                                            romaji
                                            english
                                            native
                                            userPreferred
                                        }
                                        coverImage {
                                            large
                                            medium
                                        }
                                        episodes
                                        chapters
                                        status
                                        description
                                        genres
                                        averageScore
                                        siteUrl
                                    }
                                }
                            }
                        `,
                        variables: {
                            search: query,
                            type: currentSearchType.toUpperCase()
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.errors) {
                    throw new Error(data.errors[0].message);
                }
                
                const mediaItems = data.data.Page.media;
                
                if (mediaItems.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="anilist-error">
                            –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üòî<br>
                            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
                        </div>
                    `;
                    return;
                }
                
                resultsContainer.innerHTML = mediaItems.map(item => `
                    <div class="anilist-result-item" onclick="selectAniListItem(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                        <img src="${item.coverImage.large || item.coverImage.medium}" 
                             class="anilist-cover" 
                             alt="${item.title.userPreferred}"
                             onerror="this.src='https://via.placeholder.com/60x90/667eea/ffffff?text=üé¨'">
                        <div class="anilist-info">
                            <div class="anilist-title">${item.title.userPreferred}</div>
                            <div class="anilist-meta">
                                ${currentSearchType === 'anime' ? 
                                    `–≠–ø–∏–∑–æ–¥—ã: ${item.episodes || '?'} ‚Ä¢ ` : 
                                    `–ì–ª–∞–≤—ã: ${item.chapters || '?'} ‚Ä¢ `}
                                –†–µ–π—Ç–∏–Ω–≥: ${item.averageScore ? (item.averageScore / 10).toFixed(1) + '‚≠ê' : '–ù–µ—Ç'}
                            </div>
                            <div class="anilist-meta">
                                ${item.genres ? item.genres.slice(0, 3).join(', ') : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('AniList search error:', error);
                resultsContainer.innerHTML = `
                    <div class="anilist-error">
                        –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}<br>
                        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
                    </div>
                `;
            }
        }

        function selectAniListItem(item) {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            if (currentSearchType === 'anime') {
                document.getElementById('animeTitle').value = item.title.userPreferred;
                document.getElementById('animeCover').value = item.coverImage.large || item.coverImage.medium || '';
                document.getElementById('animeEpisodes').value = item.episodes || 12;
                
                // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–ª–æ–∂–∫–∏
                previewCover('anime');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ü–µ–Ω–∫–∏ AniList
                if (item.averageScore) {
                    const rating = Math.round(item.averageScore / 20); // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º 100-–±–∞–ª–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –≤ 5-–∑–≤–µ–∑–¥–æ—á–Ω—É—é
                    currentAnimeRating = Math.min(Math.max(rating, 1), 5);
                    
                    document.querySelectorAll('#animeRating .star').forEach((star, index) => {
                        if (index < currentAnimeRating) {
                            star.classList.add('active');
                        } else {
                            star.classList.remove('active');
                        }
                    });
                }
                
            } else {
                document.getElementById('mangaTitle').value = item.title.userPreferred;
                document.getElementById('mangaCover').value = item.coverImage.large || item.coverImage.medium || '';
                document.getElementById('mangaChapters').value = item.chapters || 50;
                
                // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–ª–æ–∂–∫–∏
                previewCover('manga');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥
                if (item.averageScore) {
                    const rating = Math.round(item.averageScore / 20);
                    currentMangaRating = Math.min(Math.max(rating, 1), 5);
                    
                    document.querySelectorAll('#mangaRating .star').forEach((star, index) => {
                        if (index < currentMangaRating) {
                            star.classList.add('active');
                        } else {
                            star.classList.remove('active');
                        }
                    });
                }
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeAniListModal();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('‚úÖ –ù–∞–π–¥–µ–Ω–æ –≤ AniList', `–î–∞–Ω–Ω—ã–µ –¥–ª—è "${item.title.userPreferred}" –∑–∞–≥—Ä—É–∂–µ–Ω—ã`, 'success');
        }

        // üîß PWA –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨
        function initializePWA() {
            if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
                isPWAInstalled = true;
                console.log('PWA is installed');
            }

            window.addEventListener('beforeinstallprompt', (e) => {
                if (isTelegramWebApp) {
                    console.log('PWA install prompt suppressed in Telegram Web App');
                    return;
                }
                
                e.preventDefault();
                deferredPrompt = e;
                console.log('PWA install prompt available');
                document.getElementById('btnPwaInstall').style.display = 'block';
            });

            window.addEventListener('appinstalled', () => {
                isPWAInstalled = true;
                deferredPrompt = null;
                console.log('PWA was installed');
                showNotification('‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
                document.getElementById('pwaInstallPrompt').classList.remove('show');
                document.getElementById('btnPwaInstall').style.display = 'none';
            });

            if ('serviceWorker' in navigator && !isTelegramWebApp) {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            }
        }

        function showPWAInstallPrompt() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                });
            } else if (isPWAInstalled) {
                showNotification('‚ÑπÔ∏è –£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', 'info');
            } else {
                showNotification('‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ', '–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π', 'warning');
            }
        }

        function installPWA() {
            showPWAInstallPrompt();
        }

        function dismissPWA() {
            document.getElementById('pwaInstallPrompt').classList.remove('show');
        }

        // üîß –¢–ï–ö–°–¢–´ –ù–ê –†–ê–ó–ù–´–• –Ø–ó–´–ö–ê–•
        const translations = {
            ru: {
                welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ AniManga Tracker!",
                welcomeSubtitle: "–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –∞–Ω–∏–º–µ –∏ –º–∞–Ω–≥—É",
                anime: "–ê–Ω–∏–º–µ",
                manga: "–ú–∞–Ω–≥–∞",
                stats: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏",
                addAnime: "üé¨ –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–µ",
                addManga: "üìö –î–æ–±–∞–≤–∏—Ç—å –º–∞–Ω–≥—É",
                animeTitle: "–ù–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∏–º–µ",
                mangaTitle: "–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–Ω–≥–∏",
                coverLink: "–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–æ–∂–∫—É",
                status: "–°—Ç–∞—Ç—É—Å",
                totalEpisodes: "–í—Å–µ–≥–æ —ç–ø–∏–∑–æ–¥–æ–≤",
                watchedEpisodes: "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ —ç–ø–∏–∑–æ–¥–æ–≤",
                totalChapters: "–í—Å–µ–≥–æ –≥–ª–∞–≤",
                readChapters: "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ –≥–ª–∞–≤",
                rating: "–†–µ–π—Ç–∏–Ω–≥",
                ratingHelp: "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–≤–µ–∑–¥—É –¥–ª—è –æ—Ü–µ–Ω–∫–∏",
                searchAnime: "üîç –ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ...",
                searchManga: "üîç –ü–æ–∏—Å–∫ –º–∞–Ω–≥–∏...",
                all: "–í—Å–µ",
                watching: "–°–º–æ—Ç—Ä—é",
                reading: "–ß–∏—Ç–∞—é",
                planned: "–ü–ª–∞–Ω—ã",
                completed: "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ",
                dropped: "–ë—Ä–æ—à–µ–Ω–æ",
                totalAnime: "–í—Å–µ–≥–æ –∞–Ω–∏–º–µ",
                totalManga: "–í—Å–µ–≥–æ –º–∞–Ω–≥–∏",
                completedAnime: "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ",
                completedManga: "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ",
                statsTitle: "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
                statsChartsTitle: "–ì—Ä–∞—Ñ–∏–∫–∏",
                settingsTitle: "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏",
                themeLabel: "–¢–µ–º–∞",
                themeDesc: "–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–µ—Ç–ª—É—é –∏–ª–∏ —Ç–µ–º–Ω—É—é —Ç–µ–º—É",
                themeDark: "üåô –¢–µ–º–Ω–∞—è",
                themeLight: "‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è",
                languageLabel: "–Ø–∑—ã–∫",
                languageDesc: "–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",
                languageRu: "üá∑üá∫ –†—É—Å—Å–∫–∏–π",
                languageEn: "üá∫üá∏ English",
                pwaLabel: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
                pwaDesc: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ Telegram",
                pwaInstall: "üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å",
                exportLabel: "–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",
                exportDesc: "–°–∫–∞—á–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö",
                importLabel: "–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö",
                importDesc: "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞",
                exportBtn: "üì• –≠–∫—Å–ø–æ—Ä—Ç",
                importBtn: "üì§ –ò–º–ø–æ—Ä—Ç",
                clearData: "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ",
                edit: "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",
                delete: "üóëÔ∏è –£–¥–∞–ª–∏—Ç—å",
                progress: "üìà –ü—Ä–æ–≥—Ä–µ—Å—Å",
                noItems: "–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤",
                addFirstItem: "–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç",
                noResults: "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
                tryChangingSearch: "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å",
                confirmDelete: "–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç?",
                success: "–£—Å–ø–µ—Ö",
                error: "–û—à–∏–±–∫–∞",
                added: "–¥–æ–±–∞–≤–ª–µ–Ω–æ",
                deleted: "—É–¥–∞–ª–µ–Ω–æ",
                updated: "–æ–±–Ω–æ–≤–ª–µ–Ω–æ",
                saveError: "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",
                invalidFile: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞",
                dataExported: "–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã",
                dataImported: "–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã",
                allDataDeleted: "–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã",
                confirmClearData: "–í—ã —É–≤–µ—Ä–µ–Ω—ã? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ.",
                loading: "–ó–∞–≥—Ä—É–∑–∫–∞...",
                loadingAnime: "–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∏–º–µ...",
                loadingManga: "–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–Ω–≥–∏...",
                completed: "–ó–∞–≤–µ—Ä—à–µ–Ω–æ!",
                continueWatching: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä",
                continueReading: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á—Ç–µ–Ω–∏–µ",
                pwaInstallTitle: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ",
                pwaInstallMessage: "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ AniManga Tracker –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ Telegram",
                pwaInstalledTitle: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!",
                pwaInstalledMessage: "–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ Telegram",
                pwaAlreadyInstalledTitle: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ",
                pwaAlreadyInstalledMessage: "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –≤–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ",
                pwaNotSupportedTitle: "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞",
                pwaNotSupportedMessage: "–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π",
                required: "–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è",
                noCover: "–ù–µ—Ç –æ–±–ª–æ–∂–∫–∏",
                noWatching: "–ù–µ—Ç –∞–Ω–∏–º–µ –≤ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ",
                noReading: "–ù–µ—Ç –º–∞–Ω–≥–∏ –≤ —á—Ç–µ–Ω–∏–∏",
                noPlanned: "–ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö",
                noCompleted: "–ù–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö",
                noDropped: "–ù–µ—Ç –±—Ä–æ—à–µ–Ω–Ω—ã—Ö",
                addToPlanned: "–î–æ–±–∞–≤—å—Ç–µ –≤ –ø–ª–∞–Ω—ã",
                completeItems: "–ó–∞–≤–µ—Ä—à–∏—Ç–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è",
                dropItems: "–ë—Ä–æ—Å—å—Ç–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è",
                distributionByStatus: "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º",
                save: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
                cancel: "–û—Ç–º–µ–Ω–∞",
                markAsCompleted: "–ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å—ë",
                markAllEpisodes: "–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ —ç–ø–∏–∑–æ–¥—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–º–∏",
                markAllChapters: "–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –≥–ª–∞–≤—ã –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏",
                autoProgress: "–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ –º–∞–∫—Å–∏–º—É–º –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞",
                maxProgressReached: "–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º —ç–ø–∏–∑–æ–¥–æ–≤/–≥–ª–∞–≤",
                searchAniList: "–ü–æ–∏—Å–∫ –≤ AniList",
                aniListSearch: "–ü–æ–∏—Å–∫ –≤ AniList",
                aniListResults: "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞",
                noResultsFound: "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
                tryDifferentQuery: "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å",
                searchError: "–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞",
                checkInternet: "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É"
            },
            en: {
                welcome: "Welcome to AniManga Tracker!",
                welcomeSubtitle: "Track your anime and manga",
                anime: "Anime",
                manga: "Manga",
                stats: "Statistics",
                settings: "Settings",
                addAnime: "üé¨ Add Anime",
                addManga: "üìö Add Manga",
                animeTitle: "Anime Title",
                mangaTitle: "Manga Title",
                coverLink: "Cover Link",
                status: "Status",
                totalEpisodes: "Total Episodes",
                watchedEpisodes: "Watched Episodes",
                totalChapters: "Total Chapters",
                readChapters: "Read Chapters",
                rating: "Rating",
                ratingHelp: "Click on a star to rate",
                searchAnime: "üîç Search anime...",
                searchManga: "üîç Search manga...",
                all: "All",
                watching: "Watching",
                reading: "Reading",
                planned: "Planned",
                completed: "Completed",
                dropped: "Dropped",
                totalAnime: "Total Anime",
                totalManga: "Total Manga",
                completedAnime: "Completed",
                completedManga: "Completed",
                statsTitle: "üìä Statistics",
                statsChartsTitle: "Charts",
                settingsTitle: "‚öôÔ∏è Settings",
                themeLabel: "Theme",
                themeDesc: "Choose light or dark theme",
                themeDark: "üåô Dark",
                themeLight: "‚òÄÔ∏è Light",
                languageLabel: "Language",
                languageDesc: "Choose interface language",
                languageRu: "üá∑üá∫ Russian",
                languageEn: "üá∫üá∏ English",
                pwaLabel: "Install App",
                pwaDesc: "Install the app for access without Telegram",
                pwaInstall: "üì± Install",
                exportLabel: "Export Data",
                exportDesc: "Download your data backup",
                importLabel: "Import Data",
                importDesc: "Upload data from file",
                exportBtn: "üì• Export",
                importBtn: "üì§ Import",
                clearData: "üóëÔ∏è Clear All Data",
                edit: "‚úèÔ∏è Edit",
                delete: "üóëÔ∏è Delete",
                progress: "üìà Progress",
                noItems: "No items",
                addFirstItem: "Add first item",
                noResults: "No results found",
                tryChangingSearch: "Try changing your search",
                confirmDelete: "Delete this item?",
                success: "Success",
                error: "Error",
                added: "added",
                deleted: "deleted",
                updated: "updated",
                saveError: "Save error",
                invalidFile: "Invalid file format",
                dataExported: "Data exported",
                dataImported: "Data imported",
                allDataDeleted: "All data deleted",
                confirmClearData: "Are you sure? This will delete all your data.",
                loading: "Loading...",
                loadingAnime: "Loading anime...",
                loadingManga: "Loading manga...",
                completed: "Completed!",
                continueWatching: "Continue watching",
                continueReading: "Continue reading",
                pwaInstallTitle: "Install App",
                pwaInstallMessage: "Install AniManga Tracker for quick access without Telegram",
                pwaInstalledTitle: "App installed!",
                pwaInstalledMessage: "You can now open the app without Telegram",
                pwaAlreadyInstalledTitle: "App already installed",
                pwaAlreadyInstalledMessage: "The app is already installed on your device",
                pwaNotSupportedTitle: "Installation not available",
                pwaNotSupportedMessage: "Your browser doesn't support app installation",
                required: "required",
                noCover: "No cover",
                noWatching: "No anime in watching",
                noReading: "No manga in reading",
                noPlanned: "No planned items",
                noCompleted: "No completed items",
                noDropped: "No dropped items",
                addToPlanned: "Add to planned",
                completeItems: "Complete items",
                dropItems: "Drop items",
                distributionByStatus: "Distribution by status",
                save: "Save",
                cancel: "Cancel",
                markAsCompleted: "Complete All",
                markAllEpisodes: "Mark all episodes as watched",
                markAllChapters: "Mark all chapters as read",
                autoProgress: "Progress set to maximum for completed status",
                maxProgressReached: "Maximum episodes/chapters reached",
                searchAniList: "Search in AniList",
                aniListSearch: "Search in AniList",
                aniListResults: "Search results",
                noResultsFound: "No results found",
                tryDifferentQuery: "Try different query",
                searchError: "Search error",
                checkInternet: "Check internet connection"
            }
        };

        // üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM WEB APP
        function initTelegramApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                isTelegramWebApp = true;
                tg = window.Telegram.WebApp;
                tg.expand();
                tg.enableClosingConfirmation();
                
                document.documentElement.style.setProperty('--tg-theme-bg-color', 'var(--bg-color)');
                document.documentElement.style.setProperty('--tg-theme-text-color', 'var(--text-color)');
                document.documentElement.style.setProperty('--tg-theme-hint-color', 'var(--text-color)');
                document.documentElement.style.setProperty('--tg-theme-link-color', 'var(--accent-color)');
                document.documentElement.style.setProperty('--tg-theme-button-color', 'var(--accent-color)');
                document.documentElement.style.setProperty('--tg-theme-button-text-color', '#ffffff');
                
                document.getElementById('btnPwaInstall').style.display = 'none';
                
                setTimeout(() => {
                    showNotification(getText('welcome'), getText('welcomeSubtitle'), 'info');
                }, 1000);
                
                console.log('Telegram Web App initialized successfully');
            } else {
                console.log('Telegram Web App not detected, running in standalone mode');
                isTelegramWebApp = false;
                
                setTimeout(() => {
                    if (!isPWAInstalled && deferredPrompt) {
                        document.getElementById('pwaInstallPrompt').classList.add('show');
                    }
                }, 3000);
            }
        }

        // üîß –°–ò–°–¢–ï–ú–ê –Ø–ó–´–ö–û–í
        function getText(key) {
            return translations[currentLanguage][key] || key;
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            saveSettings();
            updateUI();
            showNotification(getText('success'), getText('languageLabel') + ' ' + getText('updated'), 'success');
        }

        function updateUI() {
            document.querySelector('title').textContent = 'AniManga Tracker';
            document.getElementById('welcomeText').textContent = getText('welcomeSubtitle');
            
            document.getElementById('tabAnime').textContent = 'üé¨ ' + getText('anime');
            document.getElementById('tabManga').textContent = 'üìö ' + getText('manga');
            document.getElementById('tabStats').textContent = getText('stats');
            document.getElementById('tabSettings').textContent = getText('settings');
            
            document.getElementById('labelAnimeTitle').textContent = getText('animeTitle');
            document.getElementById('animeTitle').placeholder = getText('animeTitle');
            document.getElementById('labelAnimeCover').textContent = getText('coverLink');
            document.getElementById('animeCover').placeholder = getText('coverLink');
            document.getElementById('labelAnimeStatus').textContent = getText('status');
            document.getElementById('labelAnimeEpisodes').textContent = getText('totalEpisodes');
            document.getElementById('labelAnimeProgress').textContent = getText('watchedEpisodes');
            document.getElementById('labelAnimeRating').textContent = getText('rating');
            document.getElementById('animeRatingHelp').textContent = getText('ratingHelp');
            document.getElementById('btnAddAnime').textContent = getText('addAnime');
            document.getElementById('animeSearch').placeholder = getText('searchAnime');
            document.getElementById('loadingAnimeText').textContent = getText('loadingAnime');
            
            document.getElementById('labelMangaTitle').textContent = getText('mangaTitle');
            document.getElementById('mangaTitle').placeholder = getText('mangaTitle');
            document.getElementById('labelMangaCover').textContent = getText('coverLink');
            document.getElementById('mangaCover').placeholder = getText('coverLink');
            document.getElementById('labelMangaStatus').textContent = getText('status');
            document.getElementById('labelMangaChapters').textContent = getText('totalChapters');
            document.getElementById('labelMangaProgress').textContent = getText('readChapters');
            document.getElementById('labelMangaRating').textContent = getText('rating');
            document.getElementById('mangaRatingHelp').textContent = getText('ratingHelp');
            document.getElementById('btnAddManga').textContent = getText('addManga');
            document.getElementById('mangaSearch').placeholder = getText('searchManga');
            document.getElementById('loadingMangaText').textContent = getText('loadingManga');
            
            updateStatusTabs();
            
            document.getElementById('statsTitle').textContent = getText('statsTitle');
            document.getElementById('statsChartsTitle').textContent = getText('statsChartsTitle');
            document.getElementById('statTotalAnime').textContent = getText('totalAnime');
            document.getElementById('statTotalManga').textContent = getText('totalManga');
            document.getElementById('statCompletedAnime').textContent = getText('completedAnime');
            document.getElementById('statCompletedManga').textContent = getText('completedManga');
            
            document.getElementById('settingsTitle').textContent = getText('settingsTitle');
            document.getElementById('settingsThemeLabel').textContent = getText('themeLabel');
            document.getElementById('settingsThemeDesc').textContent = getText('themeDesc');
            document.getElementById('themeDark').textContent = getText('themeDark');
            document.getElementById('themeLight').textContent = getText('themeLight');
            document.getElementById('settingsLanguageLabel').textContent = getText('languageLabel');
            document.getElementById('settingsLanguageDesc').textContent = getText('languageDesc');
            document.getElementById('langRu').textContent = getText('languageRu');
            document.getElementById('langEn').textContent = getText('languageEn');
            document.getElementById('settingsPwaLabel').textContent = getText('pwaLabel');
            document.getElementById('settingsPwaDesc').textContent = getText('pwaDesc');
            document.getElementById('btnPwaInstall').textContent = getText('pwaInstall');
            document.getElementById('settingsExportLabel').textContent = getText('exportLabel');
            document.getElementById('settingsExportDesc').textContent = getText('exportDesc');
            document.getElementById('btnExport').textContent = getText('exportBtn');
            document.getElementById('settingsImportLabel').textContent = getText('importLabel');
            document.getElementById('settingsImportDesc').textContent = getText('importDesc');
            document.getElementById('btnImport').textContent = getText('importBtn');
            document.getElementById('btnClearData').textContent = getText('clearData');
            
            document.querySelector('#pwaInstallPrompt h4').textContent = getText('pwaInstallTitle');
            document.querySelector('#pwaInstallPrompt p').textContent = getText('pwaInstallMessage');
            document.querySelector('#pwaInstallPrompt .pwa-buttons .btn:first-child').textContent = '‚úÖ ' + (currentLanguage === 'ru' ? '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å' : 'Install');
            document.querySelector('#pwaInstallPrompt .pwa-buttons .btn:last-child').textContent = '‚ùå ' + (currentLanguage === 'ru' ? '–ü–æ–∑–∂–µ' : 'Later');
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('lang' + (currentLanguage === 'ru' ? 'Ru' : 'En')).classList.add('active');
            
            loadAnimeContent();
            loadMangaContent();
            loadStats();
        }

        function updateStatusTabs() {
            const animeStatuses = ['all', 'watching', 'planned', 'completed', 'dropped'];
            animeStatuses.forEach(status => {
                const tab = document.getElementById('animeTab' + status.charAt(0).toUpperCase() + status.slice(1));
                if (tab) {
                    const icon = status === 'all' ? 'üì∫' : 
                                status === 'watching' ? 'üëÄ' : 
                                status === 'planned' ? 'üìÖ' : 
                                status === 'completed' ? '‚úÖ' : '‚ùå';
                    tab.innerHTML = `${icon} ${getText(status)} (<span class="count">0</span>)`;
                }
            });
            
            const mangaStatuses = ['all', 'reading', 'planned', 'completed', 'dropped'];
            mangaStatuses.forEach(status => {
                const tab = document.getElementById('mangaTab' + status.charAt(0).toUpperCase() + status.slice(1));
                if (tab) {
                    const icon = status === 'all' ? 'üìö' : 
                                status === 'reading' ? 'üëÄ' : 
                                status === 'planned' ? 'üìÖ' : 
                                status === 'completed' ? '‚úÖ' : '‚ùå';
                    tab.innerHTML = `${icon} ${getText(status)} (<span class="count">0</span>)`;
                }
            });
        }

        // üîß –°–ò–°–¢–ï–ú–ê –¢–ï–ú
        function setTheme(theme) {
            currentTheme = theme;
            document.body.className = theme + '-theme';
            
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('theme' + (theme === 'dark' ? 'Dark' : 'Light')).classList.add('active');
            
            saveSettings();
            
            if (charts.statsChart) {
                loadStats();
            }
        }

        // üîß –°–ò–°–¢–ï–ú–ê –•–†–ê–ù–ï–ù–ò–Ø –î–ê–ù–ù–´–•
        function getUserId() {
            if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
                return tg.initDataUnsafe.user.id.toString();
            }
            return 'default_user';
        }

        function loadData() {
            const userId = getUserId();
            const key = `${STORAGE_KEY}_${userId}`;
            try {
                const data = localStorage.getItem(key);
                if (data) {
                    return JSON.parse(data);
                }
            } catch (e) {
                console.error('Error loading data:', e);
                showNotification(getText('error'), getText('saveError'), 'error');
            }
            
            return {
                anime: [],
                manga: [],
                settings: {
                    language: 'ru',
                    theme: 'dark'
                },
                notificationSettings: {
                    enabled: true,
                    progressReminders: true,
                    goalNotifications: true,
                    frequency: 3
                }
            };
        }

        function saveData(data) {
            const userId = getUserId();
            const key = `${STORAGE_KEY}_${userId}`;
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('Error saving data:', e);
                showNotification(getText('error'), getText('saveError'), 'error');
                return false;
            }
        }

        function loadSettings() {
            const data = loadData();
            if (data.settings) {
                currentLanguage = data.settings.language || 'ru';
                currentTheme = data.settings.theme || 'dark';
            }
        }

        function saveSettings() {
            const data = loadData();
            data.settings = {
                language: currentLanguage,
                theme: currentTheme
            };
            saveData(data);
        }

        // üîß –°–ò–°–¢–ï–ú–ê –†–ï–ô–¢–ò–ù–ì–ê
        function initializeRatingSystem() {
            const animeStars = document.querySelectorAll('#animeRating .star');
            animeStars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    currentAnimeRating = value;
                    
                    animeStars.forEach((s, index) => {
                        if (index < value) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
            });
            
            const mangaStars = document.querySelectorAll('#mangaRating .star');
            mangaStars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    currentMangaRating = value;
                    
                    mangaStars.forEach((s, index) => {
                        if (index < value) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                });
            });
        }

        // üîß –°–ò–°–¢–ï–ú–ê –°–¢–ê–¢–£–°–û–í
        function initializeStatusTabs() {
            const animeTabs = document.querySelectorAll('#animeStatusTabs .status-tab');
            animeTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const status = this.getAttribute('data-status');
                    
                    animeTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentAnimeStatusTab = status;
                    
                    document.querySelectorAll('#anime .status-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`anime${status.charAt(0).toUpperCase() + status.slice(1)}Content`).classList.add('active');
                    
                    loadAnimeContent();
                });
            });
            
            const mangaTabs = document.querySelectorAll('#mangaStatusTabs .status-tab');
            mangaTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const status = this.getAttribute('data-status');
                    
                    mangaTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentMangaStatusTab = status;
                    
                    document.querySelectorAll('#manga .status-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`manga${status.charAt(0).toUpperCase() + status.slice(1)}Content`).classList.add('active');
                    
                    loadMangaContent();
                });
            });
        }

        // üîß –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–ù–ò–ú–ï
        function handleStatusChange(type) {
            const status = document.getElementById(type + 'Status').value;
            const totalInput = document.getElementById(type === 'anime' ? 'animeEpisodes' : 'mangaChapters');
            const progressInput = document.getElementById(type === 'anime' ? 'animeProgress' : 'mangaProgress');
            
            // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "completed", —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–≤–Ω—ã–º –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
            if (status === 'completed') {
                const total = parseInt(totalInput.value) || 0;
                progressInput.value = total;
                showNotification('‚ÑπÔ∏è ' + getText('autoProgress'), getText('maxProgressReached'), 'info');
            }
        }

        function addAnime() {
            const title = document.getElementById('animeTitle').value.trim();
            const cover = document.getElementById('animeCover').value.trim();
            const status = document.getElementById('animeStatus').value;
            const episodes = parseInt(document.getElementById('animeEpisodes').value) || 12;
            let progress = parseInt(document.getElementById('animeProgress').value) || 0;
            const rating = currentAnimeRating;
            
            if (!title) {
                showNotification(getText('error'), getText('animeTitle') + ' ' + getText('required'), 'error');
                return;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "completed", –ø—Ä–æ–≥—Ä–µ—Å—Å = –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            if (status === 'completed') {
                progress = episodes;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            progress = Math.min(progress, episodes);
            
            const data = loadData();
            const newAnime = {
                id: Date.now().toString(),
                title,
                cover,
                status,
                episodes,
                progress,
                rating,
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            data.anime = data.anime || [];
            data.anime.push(newAnime);
            
            if (saveData(data)) {
                showNotification(getText('success'), `"${title}" ` + getText('added'), 'success');
                resetForm('anime');
                loadAnimeContent();
                loadStats();
                updateStatusCounts();
            } else {
                showNotification(getText('error'), getText('saveError'), 'error');
            }
        }

        function loadAnimeContent() {
            const data = loadData();
            const status = currentAnimeStatusTab;
            const container = document.getElementById(`anime${status.charAt(0).toUpperCase() + status.slice(1)}Content`);
            const searchTerm = activeSearchTerms.anime.toLowerCase();
            
            if (!data.anime || data.anime.length === 0) {
                container.innerHTML = getEmptyState('anime', status);
                updateStatusCounts();
                return;
            }
            
            let filteredAnime = data.anime;
            if (status !== 'all') {
                filteredAnime = data.anime.filter(anime => anime.status === status);
            }
            
            if (searchTerm) {
                filteredAnime = filteredAnime.filter(anime => 
                    anime.title.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredAnime.length === 0) {
                container.innerHTML = getEmptyState('anime', status, true);
            } else {
                container.innerHTML = filteredAnime.map(anime => renderAnimeItem(anime)).join('');
            }
            
            updateStatusCounts();
        }

        function renderAnimeItem(anime) {
            const progressPercent = anime.episodes > 0 ? Math.round((anime.progress / anime.episodes) * 100) : 0;
            const statusText = getStatusText(anime.status);
            const ratingStars = renderRatingStars(anime.rating);
            const isCompleted = anime.progress >= anime.episodes && anime.episodes > 0;
            
            return `
                <div class="item-card" data-id="${anime.id}">
                    <div class="item-header">
                        ${anime.cover ? 
                            `<img src="${anime.cover}" class="item-cover" alt="${anime.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` :
                            ''
                        }
                        <div class="no-cover" style="${anime.cover ? 'display: none;' : ''}">üé¨<br>${getText('noCover')}</div>
                        <div class="item-info">
                            <div class="item-title">${anime.title} ${isCompleted ? '<span class="completion-badge">' + getText('completed') + '</span>' : ''}</div>
                            <div class="item-meta">
                                ${getText('status')}: ${statusText}<br>
                                ${getText('watchedEpisodes')}: ${anime.progress}/${anime.episodes}
                            </div>
                            <div class="rating">
                                ${ratingStars}
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-color); opacity: 0.7;">
                                <span>${getText('progress')}</span>
                                <span>${progressPercent}%</span>
                            </div>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="action-btn btn-progress" onclick="updateProgress('anime', '${anime.id}', ${anime.progress + 1})">+1</button>
                        <button class="action-btn btn-edit" onclick="editItem('anime', '${anime.id}')">${getText('edit')}</button>
                        <button class="action-btn btn-delete" onclick="deleteItem('anime', '${anime.id}')">${getText('delete')}</button>
                    </div>
                    ${!isCompleted ? `
                    <div class="quick-progress">
                        <button class="quick-progress-btn" onclick="updateProgress('anime', '${anime.id}', ${anime.progress + 5})">+5</button>
                        <button class="quick-progress-btn" onclick="updateProgress('anime', '${anime.id}', ${anime.progress + 10})">+10</button>
                        <button class="quick-progress-btn" onclick="markAsCompleted('anime', '${anime.id}', ${anime.episodes})">${getText('markAsCompleted')}</button>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // üîß –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ú–ê–ù–ì–ò
        function addManga() {
            const title = document.getElementById('mangaTitle').value.trim();
            const cover = document.getElementById('mangaCover').value.trim();
            const status = document.getElementById('mangaStatus').value;
            const chapters = parseInt(document.getElementById('mangaChapters').value) || 50;
            let progress = parseInt(document.getElementById('mangaProgress').value) || 0;
            const rating = currentMangaRating;
            
            if (!title) {
                showNotification(getText('error'), getText('mangaTitle') + ' ' + getText('required'), 'error');
                return;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "completed", –ø—Ä–æ–≥—Ä–µ—Å—Å = –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            if (status === 'completed') {
                progress = chapters;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            progress = Math.min(progress, chapters);
            
            const data = loadData();
            const newManga = {
                id: Date.now().toString(),
                title,
                cover,
                status,
                chapters,
                progress,
                rating,
                createdAt: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            data.manga = data.manga || [];
            data.manga.push(newManga);
            
            if (saveData(data)) {
                showNotification(getText('success'), `"${title}" ` + getText('added'), 'success');
                resetForm('manga');
                loadMangaContent();
                loadStats();
                updateStatusCounts();
            } else {
                showNotification(getText('error'), getText('saveError'), 'error');
            }
        }

        function loadMangaContent() {
            const data = loadData();
            const status = currentMangaStatusTab;
            const container = document.getElementById(`manga${status.charAt(0).toUpperCase() + status.slice(1)}Content`);
            const searchTerm = activeSearchTerms.manga.toLowerCase();
            
            if (!data.manga || data.manga.length === 0) {
                container.innerHTML = getEmptyState('manga', status);
                updateStatusCounts();
                return;
            }
            
            let filteredManga = data.manga;
            if (status !== 'all') {
                filteredManga = data.manga.filter(manga => manga.status === status);
            }
            
            if (searchTerm) {
                filteredManga = filteredManga.filter(manga => 
                    manga.title.toLowerCase().includes(searchTerm)
                );
            }
            
            if (filteredManga.length === 0) {
                container.innerHTML = getEmptyState('manga', status, true);
            } else {
                container.innerHTML = filteredManga.map(manga => renderMangaItem(manga)).join('');
            }
            
            updateStatusCounts();
        }

        function renderMangaItem(manga) {
            const progressPercent = manga.chapters > 0 ? Math.round((manga.progress / manga.chapters) * 100) : 0;
            const statusText = getStatusText(manga.status);
            const ratingStars = renderRatingStars(manga.rating);
            const isCompleted = manga.progress >= manga.chapters && manga.chapters > 0;
            
            return `
                <div class="item-card" data-id="${manga.id}">
                    <div class="item-header">
                        ${manga.cover ? 
                            `<img src="${manga.cover}" class="item-cover" alt="${manga.title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` :
                            ''
                        }
                        <div class="no-cover" style="${manga.cover ? 'display: none;' : ''}">üìö<br>${getText('noCover')}</div>
                        <div class="item-info">
                            <div class="item-title">${manga.title} ${isCompleted ? '<span class="completion-badge">' + getText('completed') + '</span>' : ''}</div>
                            <div class="item-meta">
                                ${getText('status')}: ${statusText}<br>
                                ${getText('readChapters')}: ${manga.progress}/${manga.chapters}
                            </div>
                            <div class="rating">
                                ${ratingStars}
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-color); opacity: 0.7;">
                                <span>${getText('progress')}</span>
                                <span>${progressPercent}%</span>
                            </div>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="action-btn btn-progress" onclick="updateProgress('manga', '${manga.id}', ${manga.progress + 1})">+1</button>
                        <button class="action-btn btn-edit" onclick="editItem('manga', '${manga.id}')">${getText('edit')}</button>
                        <button class="action-btn btn-delete" onclick="deleteItem('manga', '${manga.id}')">${getText('delete')}</button>
                    </div>
                    ${!isCompleted ? `
                    <div class="quick-progress">
                        <button class="quick-progress-btn" onclick="updateProgress('manga', '${manga.id}', ${manga.progress + 5})">+5</button>
                        <button class="quick-progress-btn" onclick="updateProgress('manga', '${manga.id}', ${manga.progress + 10})">+10</button>
                        <button class="quick-progress-btn" onclick="markAsCompleted('manga', '${manga.id}', ${manga.chapters})">${getText('markAsCompleted')}</button>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // üîß –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName).classList.add('active');
            
            document.getElementById('tab' + sectionName.charAt(0).toUpperCase() + sectionName.slice(1)).classList.add('active');
            
            if (sectionName === 'stats') {
                loadStats();
            } else if (sectionName === 'anime') {
                loadAnimeContent();
            } else if (sectionName === 'manga') {
                loadMangaContent();
            }
        }

        function getStatusText(status) {
            const statuses = {
                'watching': getText('watching'),
                'reading': getText('reading'),
                'planned': getText('planned'),
                'completed': getText('completed'),
                'dropped': getText('dropped')
            };
            return statuses[status] || status;
        }

        function renderRatingStars(rating) {
            return [1,2,3,4,5].map(i => 
                `<span class="star ${i <= rating ? 'active' : ''}">‚òÖ</span>`
            ).join('');
        }

        function resetForm(type) {
            if (type === 'anime') {
                document.getElementById('animeTitle').value = '';
                document.getElementById('animeCover').value = '';
                document.getElementById('animeProgress').value = '0';
                document.getElementById('animeCoverPreview').style.display = 'none';
                currentAnimeRating = 0;
                document.querySelectorAll('#animeRating .star').forEach(star => {
                    star.classList.remove('active');
                });
            } else if (type === 'manga') {
                document.getElementById('mangaTitle').value = '';
                document.getElementById('mangaCover').value = '';
                document.getElementById('mangaProgress').value = '0';
                document.getElementById('mangaCoverPreview').style.display = 'none';
                currentMangaRating = 0;
                document.querySelectorAll('#mangaRating .star').forEach(star => {
                    star.classList.remove('active');
                });
            }
        }

        function previewCover(type) {
            const url = document.getElementById(type + 'Cover').value;
            const preview = document.getElementById(type + 'CoverPreview');
            
            if (url) {
                preview.src = url;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        function updateProgress(type, id, newProgress) {
            const data = loadData();
            const items = type === 'anime' ? data.anime : data.manga;
            const item = items.find(item => item.id === id);
            
            if (item) {
                const total = type === 'anime' ? item.episodes : item.chapters;
                const oldProgress = item.progress;
                
                // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ù–µ–ª—å–∑—è –ø—Ä–µ–≤—ã—à–∞—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                item.progress = Math.min(newProgress, total);
                item.lastUpdated = new Date().toISOString();
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
                if (item.progress >= total && item.status !== 'completed') {
                    item.status = 'completed';
                    showNotification('üéâ ' + getText('success'), `"${item.title}" ${getText('completed')}!`, 'success');
                }
                
                if (item.progress > oldProgress) {
                    const progressMade = item.progress - oldProgress;
                    if (progressMade >= 3) {
                        showNotification('üöÄ ' + getText('success'), `${getText('progress')}: +${progressMade} ${type === 'anime' ? getText('watchedEpisodes') : getText('readChapters')}`, 'info');
                    }
                }
                
                if (saveData(data)) {
                    if (type === 'anime') {
                        loadAnimeContent();
                    } else {
                        loadMangaContent();
                    }
                    loadStats();
                    updateStatusCounts();
                }
            }
        }

        // üîß –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–µ
        function markAsCompleted(type, id, total) {
            updateProgress(type, id, total);
        }

        function editItem(type, id) {
            const data = loadData();
            const items = type === 'anime' ? data.anime : data.manga;
            const item = items.find(item => item.id === id);
            
            if (item) {
                const progressPercent = type === 'anime' ? 
                    (item.episodes > 0 ? Math.round((item.progress / item.episodes) * 100) : 0) :
                    (item.chapters > 0 ? Math.round((item.progress / item.chapters) * 100) : 0);
                
                const editForm = `
                    <div class="edit-form">
                        <h4 style="color: var(--accent-color); margin-bottom: 15px;">${getText('edit')} "${item.title}"</h4>
                        <div class="form-group">
                            <label>${getText(type + 'Title')}</label>
                            <input type="text" id="edit${type.charAt(0).toUpperCase() + type.slice(1)}Title" class="form-control" value="${item.title}">
                        </div>
                        <div class="form-group">
                            <label>${getText('coverLink')}</label>
                            <input type="text" id="edit${type.charAt(0).toUpperCase() + type.slice(1)}Cover" class="form-control" value="${item.cover || ''}" onchange="previewEditCover('${type}')">
                            <img id="edit${type.charAt(0).toUpperCase() + type.slice(1)}CoverPreview" class="cover-preview" src="${item.cover || ''}" style="${item.cover ? 'display: block;' : 'display: none;'}" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±–ª–æ–∂–∫–∏">
                        </div>
                        <div class="form-group">
                            <label>${getText('status')}</label>
                            <select id="edit${type.charAt(0).toUpperCase() + type.slice(1)}Status" class="form-control" onchange="handleEditStatusChange('${type}')">
                                <option value="${type === 'anime' ? 'watching' : 'reading'}" ${item.status === (type === 'anime' ? 'watching' : 'reading') ? 'selected' : ''}>${getText(type === 'anime' ? 'watching' : 'reading')}</option>
                                <option value="planned" ${item.status === 'planned' ? 'selected' : ''}>${getText('planned')}</option>
                                <option value="completed" ${item.status === 'completed' ? 'selected' : ''}>${getText('completed')}</option>
                                <option value="dropped" ${item.status === 'dropped' ? 'selected' : ''}>${getText('dropped')}</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>${type === 'anime' ? getText('totalEpisodes') : getText('totalChapters')}</label>
                            <input type="number" id="edit${type.charAt(0).toUpperCase() + type.slice(1)}Total" class="form-control" value="${type === 'anime' ? item.episodes : item.chapters}" min="1">
                        </div>
                        <div class="form-group">
                            <label>${type === 'anime' ? getText('watchedEpisodes') : getText('readChapters')}</label>
                            <input type="number" id="edit${type.charAt(0).toUpperCase() + type.slice(1)}Progress" class="form-control" value="${item.progress}" min="0">
                        </div>
                        <div class="form-group">
                            <label>${getText('rating')}</label>
                            <div class="rating" id="edit${type.charAt(0).toUpperCase() + type.slice(1)}Rating">
                                <span class="star ${item.rating >= 1 ? 'active' : ''}" data-value="1">‚òÖ</span>
                                <span class="star ${item.rating >= 2 ? 'active' : ''}" data-value="2">‚òÖ</span>
                                <span class="star ${item.rating >= 3 ? 'active' : ''}" data-value="3">‚òÖ</span>
                                <span class="star ${item.rating >= 4 ? 'active' : ''}" data-value="4">‚òÖ</span>
                                <span class="star ${item.rating >= 5 ? 'active' : ''}" data-value="5">‚òÖ</span>
                            </div>
                        </div>
                        <div class="edit-actions">
                            <button class="btn btn-save" onclick="save${type.charAt(0).toUpperCase() + type.slice(1)}Edit('${item.id}')">üíæ ${getText('save')}</button>
                            <button class="btn btn-cancel" onclick="cancelEdit('${type}', '${item.id}')">‚ùå ${getText('cancel')}</button>
                        </div>
                    </div>
                `;
                
                const card = document.querySelector(`.item-card[data-id="${id}"]`);
                card.outerHTML = editForm;
                
                initializeEditRating(type, item.id, item.rating);
            }
        }

        function handleEditStatusChange(type) {
            const status = document.getElementById(`edit${type.charAt(0).toUpperCase() + type.slice(1)}Status`).value;
            const totalInput = document.getElementById(`edit${type.charAt(0).toUpperCase() + type.slice(1)}Total`);
            const progressInput = document.getElementById(`edit${type.charAt(0).toUpperCase() + type.slice(1)}Progress`);
            
            // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "completed", —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–≤–Ω—ã–º –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
            if (status === 'completed') {
                const total = parseInt(totalInput.value) || 0;
                progressInput.value = total;
            }
        }

        function initializeEditRating(type, id, rating) {
            const stars = document.querySelectorAll(`#edit${type.charAt(0).toUpperCase() + type.slice(1)}Rating .star`);
            let currentRating = rating;
            
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    currentRating = value;
                    
                    stars.forEach((s, index) => {
                        if (index < value) {
                            s.classList.add('active');
                        } else {
                            s.classList.remove('active');
                        }
                    });
                    
                    if (type === 'anime') {
                        currentAnimeRating = value;
                    } else {
                        currentMangaRating = value;
                    }
                });
            });
        }

        function saveAnimeEdit(id) {
            const title = document.getElementById('editAnimeTitle').value.trim();
            const cover = document.getElementById('editAnimeCover').value.trim();
            const status = document.getElementById('editAnimeStatus').value;
            const episodes = parseInt(document.getElementById('editAnimeTotal').value) || 12;
            let progress = parseInt(document.getElementById('editAnimeProgress').value) || 0;
            const rating = currentAnimeRating;
            
            if (!title) {
                showNotification(getText('error'), getText('animeTitle') + ' ' + getText('required'), 'error');
                return;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "completed", –ø—Ä–æ–≥—Ä–µ—Å—Å = –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            if (status === 'completed') {
                progress = episodes;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            progress = Math.min(progress, episodes);
            
            const data = loadData();
            const anime = data.anime.find(a => a.id === id);
            
            if (anime) {
                anime.title = title;
                anime.cover = cover; // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–ª–æ–∂–∫–∏
                anime.status = status;
                anime.episodes = episodes;
                anime.progress = progress;
                anime.rating = rating;
                anime.lastUpdated = new Date().toISOString();
                
                if (saveData(data)) {
                    showNotification(getText('success'), `"${title}" ` + getText('updated'), 'success');
                    loadAnimeContent();
                    loadStats();
                    updateStatusCounts();
                }
            }
        }

        function saveMangaEdit(id) {
            const title = document.getElementById('editMangaTitle').value.trim();
            const cover = document.getElementById('editMangaCover').value.trim();
            const status = document.getElementById('editMangaStatus').value;
            const chapters = parseInt(document.getElementById('editMangaTotal').value) || 50;
            let progress = parseInt(document.getElementById('editMangaProgress').value) || 0;
            const rating = currentMangaRating;
            
            if (!title) {
                showNotification(getText('error'), getText('mangaTitle') + ' ' + getText('required'), 'error');
                return;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "completed", –ø—Ä–æ–≥—Ä–µ—Å—Å = –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            if (status === 'completed') {
                progress = chapters;
            }
            
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            progress = Math.min(progress, chapters);
            
            const data = loadData();
            const manga = data.manga.find(m => m.id === id);
            
            if (manga) {
                manga.title = title;
                manga.cover = cover; // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±–ª–æ–∂–∫–∏
                manga.status = status;
                manga.chapters = chapters;
                manga.progress = progress;
                manga.rating = rating;
                manga.lastUpdated = new Date().toISOString();
                
                if (saveData(data)) {
                    showNotification(getText('success'), `"${title}" ` + getText('updated'), 'success');
                    loadMangaContent();
                    loadStats();
                    updateStatusCounts();
                }
            }
        }

        function cancelEdit(type, id) {
            if (type === 'anime') {
                loadAnimeContent();
            } else {
                loadMangaContent();
            }
        }

        function deleteItem(type, id) {
            if (confirm(getText('confirmDelete'))) {
                const data = loadData();
                if (type === 'anime') {
                    data.anime = data.anime.filter(item => item.id !== id);
                } else {
                    data.manga = data.manga.filter(item => item.id !== id);
                }
                
                if (saveData(data)) {
                    showNotification(getText('success'), getText('deleted'), 'success');
                    if (type === 'anime') {
                        loadAnimeContent();
                    } else {
                        loadMangaContent();
                    }
                    loadStats();
                    updateStatusCounts();
                }
            }
        }

        function searchItems(type) {
            const searchTerm = document.getElementById(type + 'Search').value;
            activeSearchTerms[type] = searchTerm;
            
            if (type === 'anime') {
                loadAnimeContent();
            } else {
                loadMangaContent();
            }
        }

        function updateStatusCounts() {
            const data = loadData();
            
            const animeStatuses = ['all', 'watching', 'planned', 'completed', 'dropped'];
            animeStatuses.forEach(status => {
                let count = 0;
                if (status === 'all') {
                    count = data.anime ? data.anime.length : 0;
                } else {
                    count = data.anime ? data.anime.filter(anime => anime.status === status).length : 0;
                }
                
                const countElement = document.querySelector(`#animeTab${status.charAt(0).toUpperCase() + status.slice(1)} .count`);
                if (countElement) {
                    countElement.textContent = count;
                }
            });
            
            const mangaStatuses = ['all', 'reading', 'planned', 'completed', 'dropped'];
            mangaStatuses.forEach(status => {
                let count = 0;
                if (status === 'all') {
                    count = data.manga ? data.manga.length : 0;
                } else {
                    count = data.manga ? data.manga.filter(manga => manga.status === status).length : 0;
                }
                
                const countElement = document.querySelector(`#mangaTab${status.charAt(0).toUpperCase() + status.slice(1)} .count`);
                if (countElement) {
                    countElement.textContent = count;
                }
            });
        }

        function getEmptyState(type, status, isFiltered = false) {
            const typeName = type === 'anime' ? getText('anime') : getText('manga');
            const statusConfig = {
                all: { 
                    icon: type === 'anime' ? 'üì∫' : 'üìö', 
                    title: getText('noItems'), 
                    message: getText('addFirstItem') + ' ' + typeName.toLowerCase()
                },
                watching: { 
                    icon: 'üëÄ', 
                    title: getText('noWatching'), 
                    message: getText('continueWatching')
                },
                reading: { 
                    icon: 'üëÄ', 
                    title: getText('noReading'), 
                    message: getText('continueReading')
                },
                planned: { 
                    icon: 'üìÖ', 
                    title: getText('noPlanned'), 
                    message: getText('addToPlanned')
                },
                completed: { 
                    icon: '‚úÖ', 
                    title: getText('noCompleted'), 
                    message: getText('completeItems')
                },
                dropped: { 
                    icon: '‚ùå', 
                    title: getText('noDropped'), 
                    message: getText('dropItems')
                }
            };
            
            const config = statusConfig[status] || statusConfig.all;
            
            if (isFiltered) {
                return `
                    <div class="empty-state">
                        <div class="icon">üîç</div>
                        <h4>${getText('noResults')}</h4>
                        <p>${getText('tryChangingSearch')}</p>
                    </div>
                `;
            }
            
            return `
                <div class="empty-state">
                    <div class="icon">${config.icon}</div>
                    <h4>${config.title}</h4>
                    <p>${config.message}</p>
                </div>
            `;
        }

        // üîß –°–¢–ê–¢–ò–°–¢–ò–ö–ê
        function loadStats() {
            const data = loadData();
            
            const totalAnime = data.anime ? data.anime.length : 0;
            const totalManga = data.manga ? data.manga.length : 0;
            const completedAnime = data.anime ? data.anime.filter(a => a.status === 'completed').length : 0;
            const completedManga = data.manga ? data.manga.filter(m => m.status === 'completed').length : 0;
            
            document.getElementById('totalAnime').textContent = totalAnime;
            document.getElementById('totalManga').textContent = totalManga;
            document.getElementById('completedAnime').textContent = completedAnime;
            document.getElementById('completedManga').textContent = completedManga;
            
            const ctx = document.getElementById('statsChart').getContext('2d');
            
            if (charts.statsChart) {
                charts.statsChart.destroy();
            }
            
            const animeByStatus = {
                watching: data.anime ? data.anime.filter(a => a.status === 'watching').length : 0,
                planned: data.anime ? data.anime.filter(a => a.status === 'planned').length : 0,
                completed: completedAnime,
                dropped: data.anime ? data.anime.filter(a => a.status === 'dropped').length : 0
            };
            
            const mangaByStatus = {
                reading: data.manga ? data.manga.filter(m => m.status === 'reading').length : 0,
                planned: data.manga ? data.manga.filter(m => m.status === 'planned').length : 0,
                completed: completedManga,
                dropped: data.manga ? data.manga.filter(m => m.status === 'dropped').length : 0
            };
            
            charts.statsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [
                        getText('watching'), 
                        getText('reading'), 
                        getText('planned'), 
                        getText('completed'), 
                        getText('dropped')
                    ],
                    datasets: [{
                        data: [
                            animeByStatus.watching,
                            mangaByStatus.reading,
                            animeByStatus.planned + mangaByStatus.planned,
                            animeByStatus.completed + mangaByStatus.completed,
                            animeByStatus.dropped + mangaByStatus.dropped
                        ],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(255, 99, 132, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(118, 75, 162, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(255, 99, 132, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-color'),
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: getText('distributionByStatus'),
                            color: getComputedStyle(document.body).getPropertyValue('--text-color'),
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        // üîß –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò
        function exportData() {
            const data = loadData();
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `animanga-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification(getText('success'), getText('dataExported'), 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (confirm(currentLanguage === 'ru' ? '–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ?' : 'Replace current data?')) {
                            const userId = getUserId();
                            const key = `${STORAGE_KEY}_${userId}`;
                            localStorage.setItem(key, JSON.stringify(data));
                            showNotification(getText('success'), getText('dataImported'), 'success');
                            
                            loadSettings();
                            updateUI();
                            setTheme(currentTheme);
                            
                            loadAnimeContent();
                            loadMangaContent();
                            loadStats();
                            updateStatusCounts();
                        }
                    } catch (error) {
                        showNotification(getText('error'), getText('invalidFile'), 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearAllData() {
            if (confirm(getText('confirmClearData'))) {
                const userId = getUserId();
                const key = `${STORAGE_KEY}_${userId}`;
                localStorage.removeItem(key);
                showNotification(getText('success'), getText('allDataDeleted'), 'success');
                
                loadAnimeContent();
                loadMangaContent();
                loadStats();
                updateStatusCounts();
            }
        }

        // üîß –°–ò–°–¢–ï–ú–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
        function showNotification(title, message, type = 'info', duration = 5000) {
            const notificationsPanel = document.getElementById('notificationsPanel');
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            `;
            
            notificationsPanel.appendChild(notification);
            
            if (duration > 0) {
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.animation = 'slideInRight 0.3s ease reverse';
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.remove();
                            }
                        }, 300);
                    }
                }, duration);
            }
            
            return notification;
        }

        // üîß –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function previewEditCover(type) {
            const url = document.getElementById(`edit${type.charAt(0).toUpperCase() + type.slice(1)}Cover`).value;
            const preview = document.getElementById(`edit${type.charAt(0).toUpperCase() + type.slice(1)}CoverPreview`);
            
            if (url) {
                preview.src = url;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        function showProgressModal(type, id, currentProgress, maxProgress) {
            const modalHTML = `
                <div class="edit-form">
                    <h4 style="color: var(--accent-color); margin-bottom: 15px;">${getText('progress')}</h4>
                    <div class="progress-controls">
                        <button class="progress-btn" onclick="updateProgress('${type}', '${id}', ${currentProgress - 1})">-1</button>
                        <input type="number" id="progressInput" class="progress-input" value="${currentProgress}" min="0" max="${maxProgress}">
                        <button class="progress-btn" onclick="updateProgress('${type}', '${id}', ${currentProgress + 1})">+1</button>
                        <div class="progress-text">/ ${maxProgress}</div>
                    </div>
                    <div class="quick-progress">
                        <button class="quick-progress-btn" onclick="updateProgress('${type}', '${id}', ${currentProgress - 5})">-5</button>
                        <button class="quick-progress-btn" onclick="updateProgress('${type}', '${id}', ${currentProgress + 5})">+5</button>
                        <button class="quick-progress-btn" onclick="updateProgress('${type}', '${id}', ${currentProgress - 10})">-10</button>
                        <button class="quick-progress-btn" onclick="updateProgress('${type}', '${id}', ${currentProgress + 10})">+10</button>
                        <button class="quick-progress-btn" onclick="markAsCompleted('${type}', '${id}', ${maxProgress})" style="background: var(--success-color); color: white;">${getText('markAsCompleted')}</button>
                    </div>
                    <div class="edit-actions">
                        <button class="btn btn-save" onclick="applyProgress('${type}', '${id}')">üíæ ${getText('save')}</button>
                        <button class="btn btn-cancel" onclick="cancelProgress('${type}', '${id}')">‚ùå ${getText('cancel')}</button>
                    </div>
                </div>
            `;
            
            const card = document.querySelector(`.item-card[data-id="${id}"]`);
            card.outerHTML = modalHTML;
        }

        function applyProgress(type, id) {
            const progressInput = document.getElementById('progressInput');
            const newProgress = parseInt(progressInput.value) || 0;
            
            updateProgress(type, id, newProgress);
        }

        function cancelProgress(type, id) {
            if (type === 'anime') {
                loadAnimeContent();
            } else {
                loadMangaContent();
            }
        }

        // üîß –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø TELEGRAM WEB APP
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('anilistModal');
            if (event.target === modal) {
                closeAniListModal();
            }
        });

        // üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
        document.addEventListener('DOMContentLoaded', function() {
            initializePWA();
            initTelegramApp();
            loadSettings();
            initializeRatingSystem();
            initializeStatusTabs();
            setTheme(currentTheme);
            updateUI();
            loadAnimeContent();
            loadMangaContent();
            loadStats();
            updateStatusCounts();
            
            setTimeout(() => {
                showNotification(
                    'üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ!', 
                    '–î–æ–±–∞–≤–ª–µ–Ω –ø–æ–∏—Å–∫ –≤ AniList! –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîç –ü–æ–∏—Å–∫ –≤ AniList"', 
                    'info', 
                    8000
                );
            }, 2000);
            
            console.log('AniManga Tracker v' + APP_VERSION + ' with AniList integration initialized successfully');
        });

        // üîß –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø TELEGRAM BOT
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.onEvent('webAppDataReceived', (event) => {
                console.log('Data received from bot:', event);
            });
            
            Telegram.WebApp.onEvent('backButtonClicked', () => {
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    Telegram.WebApp.close();
                }
            });
            
            if (window.history.length > 1) {
                Telegram.WebApp.BackButton.show();
            }
        }
    </script>
</body>
    </html>
